 <div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Tableau de bord des Primes</h1>
    <button class="btn btn-primary" routerLink="/suivi-primes">
      <i class="material-icons me-1">arrow_back</i> Retour
    </button>
    <button class="btn btn-primary" routerLink="/projets/nouveau">
      <i class="material-icons">add_circle</i> Nouveau Projet
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && !error && dashboard" class="dashboard-content">

    <!-- KPIs -->
    <div class="row g-4 mb-4">
      <div class="col-md-3">
        <div class="kpi-card kpi-primary">
          <div class="kpi-icon">
            <i class="material-icons">payments</i>
          </div>
          <div class="kpi-content">
            <h6>Primes Attribuées</h6>
            <h3>{{ formatCurrency(dashboard.total_primes_attribuees) }}</h3>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="kpi-card kpi-success">
          <div class="kpi-icon">
            <i class="material-icons">check_circle</i>
          </div>
          <div class="kpi-content">
            <h6>Primes Payées</h6>
            <h3>{{ formatCurrency(dashboard.total_primes_payees) }}</h3>
            <span class="kpi-badge">{{ dashboard.pourcentage_global_paiement }}%</span>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="kpi-card kpi-warning">
          <div class="kpi-icon">
            <i class="material-icons">hourglass_bottom</i>
          </div>
          <div class="kpi-content">
            <h6>Primes Restantes</h6>
            <h3>{{ formatCurrency(dashboard.total_primes_restantes) }}</h3>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="kpi-card kpi-info">
          <div class="kpi-icon">
              <i class="material-icons">folder</i>
          </div>
          <div class="kpi-content">
            <h6>Projets Actifs</h6>
            <h3>{{ dashboard.projets.en_cours }}</h3>
            <small>sur {{ dashboard.projets.total }} total</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4 mb-4">
      <!-- Évolution des paiements -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h5><i class="material-icons">trending_up</i> Évolution des Paiements (30 derniers jours)</h5>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="evolutionChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Modes de paiement -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <h5><i class="material-icons">pie_chart</i> Modes de Paiement</h5>
          </div>
          <div class="card-body">
            <div class="chart-container-small">
              <canvas id="modesChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistiques Projets et Développeurs -->
    <div class="row g-4 mb-4">
      <!-- Statistiques Projets -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h5><i class="material-icons">folder_open</i> Statistiques Projets</h5>
          </div>
          <div class="card-body">
            <div class="chart-container-small">
              <canvas id="projetsChart"></canvas>
            </div>
            <div class="stats-grid mt-3">
              <div class="stat-item">
                <span class="stat-label">Avec paiements</span>
                <span class="stat-value">{{ dashboard.projets.avec_paiements }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Paiements complets</span>
                <span class="stat-value">{{ dashboard.projets.termines_paiement }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Projets -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h5><i class="material-icons">emoji_events</i> Top 5 Projets</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Projet</th>
                    <th>Prime Totale</th>
                    <th>Progression</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let projet of dashboard.top_projets"
                      [routerLink]="['/projets', projet.id]"
                      style="cursor: pointer;">
                    <td>
                      <strong>{{ projet.nom }}</strong>
                      <br>
                      <span [class]="'badge ' + getStatutBadgeClass(projet.statut)">
                        {{ getStatutLabel(projet.statut) }}
                      </span>
                      <!-- <span class="badge bg-danger">Annulé</span> -->
                    </td>
                    <td>{{ formatCurrency(projet.prime_totale) }}</td>
                    <td>
                      <div class="progress">
                        <div class="progress-bar bg-success"
                             [style.width.%]="projet.pourcentage_paiement"
                             role="progressbar">
                            </div>
                            {{ projet.pourcentage_paiement }}%
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Développeurs et Derniers Paiements -->
    <div class="row g-4">
      <!-- Top Développeurs -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h5><i class="material-icons">groups</i> Top 5 Développeurs</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Développeur</th>
                    <th>Primes</th>
                    <th>Payé</th>
                    <th>Projets</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let dev of dashboard.top_developpeurs">
                    <td>
                      <strong>{{ dev.nom_complet }}</strong>
                      <br>
                      <small class="text-muted">{{ dev.service }}</small>
                    </td>
                    <td>{{ formatCurrency(dev.total_primes) }}</td>
                    <td>
                      <span class="text-success">{{ formatCurrency(dev.total_paye) }}</span>
                    </td>
                    <td>
                      <span class="badge bg-info">{{ dev.nombre_projets }}</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Derniers Paiements -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="material-icons">history</i> Derniers Paiements</h5>
            <!-- <button class="btn btn-sm btn-outline-primary" routerLink="/prime/paiements">
              Voir tout
            </button> -->
          </div>
          <div class="card-body">
            <div class="paiements-list">
              <div *ngFor="let paiement of dashboard.derniers_paiements" class="paiement-item">
                <div class="paiement-info">
                  <div class="paiement-employe">
                    <strong>{{ paiement.employe.nom_complet }}</strong>
                    <small class="text-muted">{{ paiement.projet.nom }}</small>
                  </div>
                  <div class="paiement-details">
                    <span class="paiement-montant">{{ formatCurrency(paiement.montant) }}</span>
                    <span [class]="'badge ' + getModeBadgeClass(paiement.mode_paiement)">
                      {{ getModePaiementLabel(paiement.mode_paiement) }}
                    </span>
                  </div>
                </div>
                <small class="text-muted">{{ paiement.created_at | date: 'dd/MM/yyyy HH:mm' }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
